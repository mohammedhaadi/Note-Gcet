<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Gcet - Advanced AI Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f8fa;
        }
        #editor-container {
            height: 300px;
        }
        .ql-toolbar.ql-snow {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            border-color: #e2e8f0;
        }
        .ql-container.ql-snow {
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            border-color: #e2e8f0;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .tag {
            background-color: #e0e7ff;
            color: #4338ca;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="antialiased text-slate-800">
    <!-- AI Processing Modal -->
    <div id="aiModal" class="modal-overlay hidden">
        <div class="bg-white rounded-lg p-8 shadow-2xl text-center">
            <div class="loader mx-auto"></div>
            <p id="aiModalMessage" class="mt-4 text-slate-700 font-medium">Processing with Gemini...</p>
        </div>
    </div>
    
    <!-- Main container -->
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-2">
                        <svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z"/><path d="M15 3v6h6"/><path d="m8 15.8-2.5-2.5 2.5-2.5"/><path d="m16 12.2 2.5 2.5-2.5 2.5"/></svg>
                        <h1 class="text-2xl font-bold text-slate-900">Note Gcet</h1>
                    </div>
                    <button class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Sign In
                    </button>
                </div>
            </div>
        </header>

        <!-- App Layout -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Editor & Note Management -->
                <div class="lg:col-span-2">
                    <div id="editor-wrapper" class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                        <h2 class="text-xl font-bold mb-4 text-slate-900">Create a New Note</h2>
                        <input id="note-title" type="text" placeholder="Note Title" class="w-full mb-4 px-4 py-2 border border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <div id="editor-container"></div>
                        <div class="mt-4 flex flex-wrap gap-4 items-center">
                            <input id="note-category" type="text" placeholder="Category (e.g., Work, Study)" class="flex-grow px-4 py-2 border border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <input id="note-tags" type="text" placeholder="Tags (comma-separated)" class="flex-grow px-4 py-2 border border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button id="clear-editor-btn" class="px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200">Clear</button>
                            <button id="save-note-btn" class="px-6 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700">Save Note</button>
                        </div>
                         <input type="hidden" id="note-id">
                    </div>
                </div>

                <!-- Right Column: Notes List & Search -->
                <div class="lg:col-span-1 space-y-8">
                     <!-- AI Actions -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                        <h3 class="text-lg font-semibold mb-4 text-slate-900">AI Actions</h3>
                        <p class="text-sm text-slate-500 mb-4">Select a note from the list below to use AI features.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <button id="summarize-btn" disabled class="flex items-center justify-center p-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="align-left" class="w-5 h-5 mr-2"></i>
                                <span class="text-sm font-medium">Summarize</span>
                            </button>
                             <button id="quiz-btn" disabled class="flex items-center justify-center p-3 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="help-circle" class="w-5 h-5 mr-2"></i>
                                <span class="text-sm font-medium">Create Quiz</span>
                            </button>
                            <button id="enhance-btn" disabled class="flex items-center justify-center p-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="sparkles" class="w-5 h-5 mr-2"></i>
                                <span class="text-sm font-medium">Enhance Text</span>
                            </button>
                             <button id="title-btn" disabled class="flex items-center justify-center p-3 bg-yellow-50 text-yellow-700 rounded-lg hover:bg-yellow-100 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i data-lucide="type" class="w-5 h-5 mr-2"></i>
                                <span class="text-sm font-medium">Gen. Title</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                        <h3 class="text-lg font-semibold mb-4 text-slate-900">My Notes</h3>
                        <div class="relative mb-4">
                            <input id="search-input" type="text" placeholder="Search notes..." class="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        </div>
                        <div id="notes-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
                           <p class="text-slate-500 text-center py-4">No notes found.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Output Section -->
            <div id="ai-output-section" class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-slate-200 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="ai-output-title" class="text-xl font-bold text-slate-900">AI Output</h2>
                    <div class="flex items-center space-x-2">
                        <button id="export-ai-output-btn" class="p-2 text-slate-500 hover:bg-slate-100 rounded-md"><i data-lucide="download" class="w-5 h-5"></i></button>
                        <button id="close-ai-output-btn" class="p-2 text-slate-500 hover:bg-slate-100 rounded-md"><i data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div id="ai-output-content" class="prose max-w-none text-slate-700 p-4 bg-slate-50 rounded-lg"></div>
            </div>
        </main>
    </div>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Quill Editor Initialization
            const quill = new Quill('#editor-container', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        ['link'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['clean']
                    ]
                },
                placeholder: 'Start writing your amazing note...',
            });

            // UI Elements
            const noteTitleEl = document.getElementById('note-title');
            const noteCategoryEl = document.getElementById('note-category');
            const noteTagsEl = document.getElementById('note-tags');
            const noteIdEl = document.getElementById('note-id');
            const saveNoteBtn = document.getElementById('save-note-btn');
            const clearEditorBtn = document.getElementById('clear-editor-btn');
            const notesListEl = document.getElementById('notes-list');
            const searchInput = document.getElementById('search-input');
            const aiModal = document.getElementById('aiModal');
            const aiModalMessage = document.getElementById('aiModalMessage');
            
            const summarizeBtn = document.getElementById('summarize-btn');
            const quizBtn = document.getElementById('quiz-btn');
            const enhanceBtn = document.getElementById('enhance-btn');
            const titleBtn = document.getElementById('title-btn');

            const aiOutputSection = document.getElementById('ai-output-section');
            const aiOutputTitle = document.getElementById('ai-output-title');
            const aiOutputContent = document.getElementById('ai-output-content');
            const closeAiOutputBtn = document.getElementById('close-ai-output-btn');
            const exportAiOutputBtn = document.getElementById('export-ai-output-btn');

            let activeNoteId = null;

            // Gemini API Details
            const apiKey = ""; // Leave empty, will be handled by the environment
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            // --- Note Management ---

            function getNotes() {
                return JSON.parse(localStorage.getItem('notes-adv') || '[]');
            }

            function saveNotes(notes) {
                localStorage.setItem('notes-adv', JSON.stringify(notes));
            }

            function clearEditor() {
                noteIdEl.value = '';
                noteTitleEl.value = '';
                quill.root.innerHTML = '';
                noteCategoryEl.value = '';
                noteTagsEl.value = '';
                document.getElementById('editor-wrapper').querySelector('h2').textContent = 'Create a New Note';
                saveNoteBtn.textContent = 'Save Note';
                activeNoteId = null;
                toggleAiButtons();
            }

            function saveNote() {
                const id = noteIdEl.value || Date.now().toString();
                const title = noteTitleEl.value.trim();
                const content = quill.root.innerHTML;
                const category = noteCategoryEl.value.trim();
                const tags = noteTagsEl.value.split(',').map(tag => tag.trim()).filter(Boolean);

                if (!title || content === '<p><br></p>') {
                    alert('Please provide a title and some content for your note.');
                    return;
                }

                let notes = getNotes();
                const noteIndex = notes.findIndex(note => note.id === id);

                const newNote = { id, title, content, category, tags, updatedAt: new Date().toISOString() };

                if (noteIndex > -1) {
                    notes[noteIndex] = newNote; // Update existing
                } else {
                    notes.unshift(newNote); // Add new
                }

                saveNotes(notes);
                renderNotes();
                clearEditor();
            }

            function loadNoteIntoEditor(id) {
                const notes = getNotes();
                const note = notes.find(n => n.id === id);
                if (note) {
                    noteIdEl.value = note.id;
                    noteTitleEl.value = note.title;
                    quill.root.innerHTML = note.content;
                    noteCategoryEl.value = note.category || '';
                    noteTagsEl.value = (note.tags || []).join(', ');
                    document.getElementById('editor-wrapper').querySelector('h2').textContent = 'Edit Note';
                    saveNoteBtn.textContent = 'Update Note';
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    activeNoteId = id;
                    toggleAiButtons();
                }
            }
            
            function deleteNote(id) {
                if (confirm('Are you sure you want to delete this note?')) {
                    let notes = getNotes();
                    notes = notes.filter(note => note.id !== id);
                    saveNotes(notes);
                    renderNotes();
                    if(noteIdEl.value === id) {
                        clearEditor();
                    }
                }
            }

            function renderNotes(searchTerm = '') {
                const notes = getNotes();
                const filteredNotes = notes.filter(note => {
                    const plainContent = note.content.replace(/<[^>]+>/g, ' '); // Strip HTML for search
                    const searchLower = searchTerm.toLowerCase();
                    return note.title.toLowerCase().includes(searchLower) ||
                           plainContent.toLowerCase().includes(searchLower) ||
                           (note.category || '').toLowerCase().includes(searchLower) ||
                           (note.tags || []).some(tag => tag.toLowerCase().includes(searchLower));
                });

                notesListEl.innerHTML = '';
                if (filteredNotes.length === 0) {
                    notesListEl.innerHTML = `<p class="text-slate-500 text-center py-4">No notes found.</p>`;
                    return;
                }

                filteredNotes.forEach(note => {
                    const plainContent = note.content.replace(/<[^>]+>/g, ' ');
                    const noteEl = document.createElement('div');
                    noteEl.className = 'p-4 border border-slate-200 rounded-lg cursor-pointer hover:border-indigo-500 hover:bg-indigo-50/50';
                    noteEl.dataset.id = note.id;

                    noteEl.innerHTML = `
                        <div class="flex justify-between items-start">
                             <h4 class="font-semibold text-slate-800 mb-1">${note.title}</h4>
                             <button class="delete-btn p-1 text-slate-400 hover:text-red-500" data-id="${note.id}"><i data-lucide="trash-2" class="w-4 h-4 pointer-events-none"></i></button>
                        </div>
                        <p class="text-sm text-slate-500 mb-3">${plainContent.substring(0, 80)}...</p>
                        <div class="flex items-center justify-between text-xs text-slate-400">
                           <div class="flex flex-wrap gap-1">
                                ${note.category ? `<span class="tag bg-green-100 text-green-800">${note.category}</span>` : ''}
                                ${(note.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                           </div>
                           <span>${new Date(note.updatedAt).toLocaleDateString()}</span>
                        </div>
                    `;
                    
                    noteEl.addEventListener('click', (e) => {
                       if (e.target.closest('.delete-btn')) {
                           deleteNote(note.id);
                           e.stopPropagation();
                       } else {
                           loadNoteIntoEditor(note.id);
                       }
                    });

                    notesListEl.appendChild(noteEl);
                });
                lucide.createIcons();
            }

            // --- AI Features ---

            function toggleAiButtons() {
                const shouldBeDisabled = activeNoteId === null;
                summarizeBtn.disabled = shouldBeDisabled;
                quizBtn.disabled = shouldBeDisabled;
                enhanceBtn.disabled = shouldBeDisabled;
                titleBtn.disabled = shouldBeDisabled;
            }

            async function callGeminiAPI(prompt, modalMessage) {
                aiModalMessage.textContent = modalMessage;
                aiModal.classList.remove('hidden');
                
                try {
                    const payload = { contents: [{ parts: [{ text: prompt }] }] };
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (error) {
                    console.error('Gemini API Error:', error);
                    alert(`An error occurred: ${error.message}`);
                    return null;
                } finally {
                    aiModal.classList.add('hidden');
                }
            }
            
            function displayAiOutput(title, content) {
                if(!content) {
                    aiOutputContent.innerHTML = `<p class="text-red-500">Could not generate AI content. Please try again.</p>`;
                } else {
                    aiOutputContent.innerHTML = content.replace(/\n/g, '<br>');
                }
                aiOutputTitle.textContent = title;
                aiOutputSection.classList.remove('hidden');
                aiOutputSection.scrollIntoView({ behavior: 'smooth' });
            }

            async function handleSummarize() {
                if (!activeNoteId) return;
                const note = getNotes().find(n => n.id === activeNoteId);
                if (!note) return;

                const plainText = note.content.replace(/<[^>]+>/g, ' ').trim();
                const prompt = `Summarize the following note into key bullet points:\n\n---\n${plainText}\n---`;
                const summary = await callGeminiAPI(prompt, 'Generating summary...');
                displayAiOutput(`Summary for "${note.title}"`, summary);
            }
            
            async function handleQuiz() {
                if (!activeNoteId) return;
                const note = getNotes().find(n => n.id === activeNoteId);
                if (!note) return;
                
                const plainText = note.content.replace(/<[^>]+>/g, ' ').trim();
                const prompt = `Create a multiple-choice quiz with 3-4 questions based on the following note. For each question, provide 4 options (A, B, C, D) and indicate the correct answer clearly. The quiz should test the main concepts of the note.\n\n---\n${plainText}\n---`;
                const quiz = await callGeminiAPI(prompt, 'Creating quiz...');
                displayAiOutput(`Quiz for "${note.title}"`, quiz);
            }

            async function handleEnhanceText() {
                if (!activeNoteId) return;
                const note = getNotes().find(n => n.id === activeNoteId);
                if (!note) return;

                const plainText = note.content.replace(/<[^>]+>/g, ' ').trim();
                const prompt = `Act as an expert editor. Enhance the following text by improving clarity, fixing grammatical errors, and refining the style. Keep the original meaning intact. Output only the enhanced text.\n\n---\n${plainText}\n---`;
                const enhancedText = await callGeminiAPI(prompt, 'Enhancing text...');
                displayAiOutput(`Enhanced Text for "${note.title}"`, enhancedText);
            }

            async function handleGenerateTitle() {
                if (!activeNoteId) return;
                const note = getNotes().find(n => n.id === activeNoteId);
                if (!note) return;
                
                const plainText = note.content.replace(/<[^>]+>/g, ' ').trim();
                const prompt = `Generate 5 creative and relevant titles for the following note. The titles should be catchy and reflect the content. List them clearly.\n\n---\n${plainText}\n---`;
                const titles = await callGeminiAPI(prompt, 'Generating titles...');
                displayAiOutput(`Title ideas for "${note.title}"`, titles);
            }

            // --- Exporting ---
            function exportContent(content, filename) {
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);
            }

            // --- Event Listeners ---
            saveNoteBtn.addEventListener('click', saveNote);
            clearEditorBtn.addEventListener('click', clearEditor);
            searchInput.addEventListener('input', (e) => renderNotes(e.target.value));
            
            summarizeBtn.addEventListener('click', handleSummarize);
            quizBtn.addEventListener('click', handleQuiz);
            enhanceBtn.addEventListener('click', handleEnhanceText);
            titleBtn.addEventListener('click', handleGenerateTitle);

            closeAiOutputBtn.addEventListener('click', () => aiOutputSection.classList.add('hidden'));
            exportAiOutputBtn.addEventListener('click', () => {
                const title = aiOutputTitle.textContent.replace(/ /g, '_');
                const content = aiOutputContent.innerText;
                exportContent(content, `${title}.txt`);
            });


            // Initial Render
            renderNotes();
        });
    </script>
</body>
</html>

